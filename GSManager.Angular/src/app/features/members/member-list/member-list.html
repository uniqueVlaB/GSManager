<div class="page-container">
  <header class="page-header">
    <div class="page-title-section">
      <h1 class="page-title">Members</h1>
      <p class="page-subtitle">Manage your garden society members</p>
    </div>
    <app-button variant="primary" size="md" icon="+" (click)="addMember()">
      Add Member
    </app-button>
  </header>

  @if (error()) {
    <div class="error-banner" role="alert">
      <span>{{ error() }}</span>
      <button type="button" class="btn-dismiss" (click)="memberService.clearError()">√ó</button>
    </div>
  }

  @if (success()) {
    <div class="success-banner" role="status">
      <span>{{ success() }}</span>
      <button type="button" class="btn-dismiss" (click)="memberService.clearSuccess()">√ó</button>
    </div>
  }

  <div class="table-container">
    <div class="table-header">
      <div class="search-box">
        <label for="search" class="visually-hidden">Search members</label>
        <input
          id="search"
          type="search"
          class="search-input"
          placeholder="Search members..."
          [value]="searchQuery()"
          (input)="onSearch($event)"
        />
      </div>
    </div>

    @if (loading()) {
      <div class="loading-state">
        <span class="loading-spinner"></span>
        <p>Loading members...</p>
      </div>
    } @else {
      <div class="table-wrapper" role="region" aria-label="Members table" tabindex="0">
        <table class="data-table">
          <thead>
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Email</th>
              <th scope="col">Phone</th>
              <th scope="col">Plots</th>
              <th scope="col">
                <span class="visually-hidden">Actions</span>
              </th>
            </tr>
          </thead>
          <tbody>
            @for (member of filteredMembers(); track member.id) {
              <tr>
                <td>
                  <div class="member-name">
                    <span class="member-avatar">
                      {{ member.firstName.charAt(0) }}{{ member.lastName.charAt(0) }}
                    </span>
                    <span>{{ member.firstName }} {{ member.lastName }}</span>
                  </div>
                </td>
                <td>{{ member.email }}</td>
                <td>
                  @if (member.phoneNumber) {
                    {{ member.phoneNumber }}
                  } @else {
                    <span class="text-muted">‚Äî</span>
                  }
                </td>
                <td>
                  @if (member.plotIds && member.plotIds.length > 0) {
                    <span class="plot-badge">{{ member.plotIds.length }} plot(s)</span>
                  } @else {
                    <span class="text-muted">‚Äî</span>
                  }
                </td>
                <td>
                  <div class="action-buttons">
                    <button
                      type="button"
                      class="btn-icon-action"
                      [attr.aria-label]="'View ' + member.firstName + ' ' + member.lastName"
                      title="View details"
                      (click)="viewMember(member.id)"
                    >
                      üëÅÔ∏è
                    </button>
                    <button
                      type="button"
                      class="btn-icon-action"
                      [attr.aria-label]="'Edit ' + member.firstName + ' ' + member.lastName"
                      title="Edit member"
                      (click)="editMember(member.id)"
                    >
                      ‚úèÔ∏è
                    </button>
                  </div>
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="5" class="empty-state">
                  <div class="empty-content">
                    <span class="empty-icon">üë•</span>
                    <p>No members found</p>
                    @if (hasActiveFilters()) {
                      <button type="button" class="btn-secondary" (click)="clearFilters()">
                        Clear filters
                      </button>
                    }
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>

  @if (showAddModal()) {
    <app-add-member-modal
      (close)="onAddMemberClose()"
      (submit)="onAddMemberSubmit($event)"
    />
  }

  @if (showDetailsModal() && selectedMember(); as member) {
    <app-member-details-modal
      [member]="member"
      (close)="onDetailsModalClose()"
      (edit)="onDetailsModalEdit($event)"
    />
  }
</div>
