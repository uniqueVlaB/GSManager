<div class="page-container">
  <header class="page-header">
    <div class="page-title-section">
      <h1 class="page-title">Members</h1>
      <p class="page-subtitle">Manage your garden society members</p>
    </div>
    <app-button variant="primary" size="md" icon="+" (click)="showUpsertMemberModal()">
      Add Member
    </app-button>
  </header>

  <div class="table-container">
    <div class="table-header">
      <div class="search-box">
        <label for="search" class="visually-hidden">Search members</label>
        <input id="search" type="search" class="search-input" placeholder="Search members..." [value]="searchQuery()"
          (input)="onSearch($event)" />
      </div>
    </div>

    @if (loading()) {
    <div class="loading-state">
      <span class="loading-spinner"></span>
      <p>Loading members...</p>
    </div>
    } @else {
    <div class="table-wrapper" role="region" aria-label="Members table" tabindex="0">
      <table class="data-table">
        <thead>
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Email</th>
            <th scope="col">Phone</th>
            <th scope="col">Plots</th>
          </tr>
        </thead>
        <tbody>
          @for (member of fullMembers(); track member.id) {
          <tr (dblclick)="member.id && viewMember(member.id)">
            <td>
              <div class="member-name">
                <span class="member-avatar">
                  @if (member.firstName && member.lastName) {
                  {{ member.firstName.charAt(0) }}{{ member.lastName.charAt(0) }}
                  } @else {
                   ?
                  }
                </span>
                <span>{{ member.firstName }} {{ member.lastName }}</span>
              </div>
            </td>
            <td>{{ member.email }}</td>
            <td>
              @if (member.phoneNumber) {
              {{ member.phoneNumber }}
              } @else {
              <span class="text-muted">â€”</span>
              }
            </td>
            <td>
              @if (member && member.plots && member.plots.length > 0) {
              <div class="plot-list">
                @for (plot of member.plots; track plot.id) {
                  <span class="plot-badge">{{ plot.number }}</span>
                }
              </div>
              } @else {
              <span class="text-muted">â€”</span>
              }
            </td>
          </tr>
          } @empty {
          <tr>
            <td colspan="5" class="empty-state">
              <div class="empty-content">
                <span class="empty-icon">ðŸ‘¥</span>
                <p>No members found</p>
                @if (hasActiveFilters()) {
                <app-button variant="secondary" size="sm" (click)="clearFilters()">
                  Clear filters
                </app-button>
                }
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    }
  </div>

  @if (showUpsertModal()) {
  <app-upsert-member-modal [member]="selectedMember()" (close)="onUpsertModalClose()" (save)="onUpsertModalSubmit($event)" />
  }

  @if (showDetailsModal() && selectedFullMember(); as member) {
  <app-member-details-modal [member]="member" (close)="onDetailsModalClose()" (edit)="onDetailsModalEdit($event)" />
  }

  <app-page-selector [currentPage]="page" [totalPages]="memberService.paginatedMembers()?.totalPages || 1"
    (pageChange)="setPage($event)" (pageSizeChange)="setPageSize($event)" />
    
</div>